<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Import a mesh in FEniCS | MechEngrLorenzoFiore</title>

    



<meta name="author" content="Lorenzo Fiore" />
<meta name="description" content="Import a mesh in FEniCS Motivation and context  When I first approached the software library FEniCS I was overwhelmed by the possibilities. This collection of software allows the user to define whatever Partial Differential Equation on a geometrical domain and automate all the process from the definition of finite elements to solution of the equation, it&amp;rsquo;s simply brilliant! Wanna solve a thermal diffusion problem? Just type the heat equation in integral form:  ET = ( rho*cspec*(T_trl-T_old)/dt*T_tst &#43; \ &#43; Kcond*fe." />



<meta name="generator" content="Hugo 0.82.0" />

<link rel="canonical" href="https://MechEngrLorenzoFiore.github.io/posts/import_a_mesh_in_fenics/" />


<meta property="og:title" content="Import a mesh in FEniCS" />
<meta property="og:description" content="Import a mesh in FEniCS Motivation and context  When I first approached the software library FEniCS I was overwhelmed by the possibilities. This collection of software allows the user to define whatever Partial Differential Equation on a geometrical domain and automate all the process from the definition of finite elements to solution of the equation, it&rsquo;s simply brilliant! Wanna solve a thermal diffusion problem? Just type the heat equation in integral form:  ET = ( rho*cspec*(T_trl-T_old)/dt*T_tst &#43; \ &#43; Kcond*fe." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://MechEngrLorenzoFiore.github.io/posts/import_a_mesh_in_fenics/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-06T11:03:50&#43;00:00" />
<meta property="article:modified_time" content="2023-03-06T11:03:50&#43;00:00" />




<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Import a mesh in FEniCS"/>
<meta name="twitter:description" content="Import a mesh in FEniCS Motivation and context  When I first approached the software library FEniCS I was overwhelmed by the possibilities. This collection of software allows the user to define whatever Partial Differential Equation on a geometrical domain and automate all the process from the definition of finite elements to solution of the equation, it&rsquo;s simply brilliant! Wanna solve a thermal diffusion problem? Just type the heat equation in integral form:  ET = ( rho*cspec*(T_trl-T_old)/dt*T_tst &#43; \ &#43; Kcond*fe."/>


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css">
<link rel="stylesheet" href="/css/icomoon.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/overlayscrollbars@1.13.1/css/OverlayScrollbars.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css">
<link rel="stylesheet" href="/css/site.css" />

<style>
  a:not(.ui.button):hover {
    text-decoration: underline;
  }

  
  a:not(.ui.button) {
    color: seagreen !important;
  }
  

  

  
  body.default {
    
    background-color: #f7f7f7;
    

    
  }
  

  
</style>


    







    
  </head>

  <body class="default">
    
<nav class="ui secondary menu dream-menu">

  <div class="item">
    <i class="large link bullseye icon dream-flip-toggle" title="Flip it!"></i>
  </div>
  <div class="item">
    <i class="large link home icon" title="Home" onclick="window.location.href = 'https:\/\/MechEngrLorenzoFiore.github.io\/'"></i>
  </div>
  
  
  <div class="item">
    <i class="large link search icon" onclick="toggleSearch()"></i>
  </div>
  
</nav>

    <div class="flip-container">
      <div class="flipper">
        <section class="front">
          <div class="dream-max-width">
            
<div class="ui relaxed centered grid dream-grid dream-grid-single">
  
  
  
  

  
  <aside class="sixteen wide mobile sixteen wide tablet three wide computer column dream-single-aside">
  
    
    <div class="ui segment toc">
      <nav id="TableOfContents">
  <ul>
    <li><a href="#motivation-and-context">Motivation and context</a></li>
    <li><a href="#challenges-i-faced">Challenges I faced</a></li>
    <li><a href="#useful-lessons-i-learned">Useful lessons I learned</a></li>
  </ul>
</nav>
    </div>
    

    
  
  </aside>
  
  <div class="sixteen wide mobile sixteen wide tablet ten wide computer column markdown-body dream-single" id="dream-save-post-as-img">
    <section class="ui top attached segment">
      <header>
        <h1 class="ui large header">Import a mesh in FEniCS<div class="sub header">
            <div class="left">
              @
              
                
                  Lorenzo Fiore
                
              

              | 
                  
                    Monday, Mar 6, 2023
                  
                

              | 6 minutes read

              
            </div>

            
            <div class="dream-share">
  <a href="#" class="save-as-image" title="Save as image" onclick="savePostAsImg()">
    <i class="save icon"></i>
  </a>
  </a>
  <a href="https://www.linkedin.com/in/lorenzo-fiore-372b83194/">
    <i class="linkedin icon"></i>
  </a>
</div>




            
          </div>
        </h1>
      </header>

      <article class="main">
        

        <h1 id="import-a-mesh-in-fenics">Import a mesh in FEniCS</h1>
<h2 id="motivation-and-context">Motivation and context</h2>
<ul>
<li>When I first approached the software library FEniCS I was overwhelmed by the possibilities. This collection of software allows the user to define whatever Partial Differential Equation on a geometrical domain and automate all the process from the definition of finite elements to solution of the equation, it&rsquo;s simply brilliant! Wanna solve a thermal diffusion problem? Just type the heat equation in integral form:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">ET <span style="color:#f92672">=</span> ( rho<span style="color:#f92672">*</span>cspec<span style="color:#f92672">*</span>(T_trl<span style="color:#f92672">-</span>T_old)<span style="color:#f92672">/</span>dt<span style="color:#f92672">*</span>T_tst <span style="color:#f92672">+</span> \
     <span style="color:#f92672">+</span> Kcond<span style="color:#f92672">*</span>fe<span style="color:#f92672">.</span>dot(fe<span style="color:#f92672">.</span>grad(T_trl), fe<span style="color:#f92672">.</span>grad(T_tst)) )<span style="color:#f92672">*</span>fe<span style="color:#f92672">.</span>dx
</code></pre></div><ul>
<li>Wanna add convection through one of the boundaries? Just add that part to the equation:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">ET <span style="color:#f92672">=</span> ( rho<span style="color:#f92672">*</span>cspec<span style="color:#f92672">*</span>(T_trl<span style="color:#f92672">-</span>T_old)<span style="color:#f92672">/</span>dt<span style="color:#f92672">*</span>T_tst <span style="color:#f92672">+</span>\
     <span style="color:#f92672">+</span> Kcond<span style="color:#f92672">*</span>fe<span style="color:#f92672">.</span>dot(fe<span style="color:#f92672">.</span>grad(T_trl), fe<span style="color:#f92672">.</span>grad(T_tst)) )<span style="color:#f92672">*</span>fe<span style="color:#f92672">.</span>dx <span style="color:#f92672">+</span>\
	 <span style="color:#f92672">+</span> ( outer_hconv<span style="color:#f92672">*</span>(T_trl <span style="color:#f92672">-</span> outer_Temp)<span style="color:#f92672">*</span>T_tst )<span style="color:#f92672">*</span>ds_outer
</code></pre></div><ul>
<li>But here comes the catch, how to indicate to the software what part of the domain is <code>ds_outer</code>? Seems like this is a limitation of the script like interface in FEniCS, using the provided functionalities (such as <code>CompiledSubDomain</code>), you can only define the geometry if you can type the equation for it.</li>
<li>Well I refused to stop there, so I spent too many hours googling for a solution and I ended up collection enough pieces of code from the internet (mainly from Jørgen S. Dokken) to reach my goal: import mesh boundary definition from an external pre-processor to FEniCS.</li>
</ul>
<h2 id="challenges-i-faced">Challenges I faced</h2>
<ul>
<li>Before coming to FEniCS, the input mesh, coming from a pre-processor, has to be translated in a suitable format, I chose <code>xdmf</code> and this can be achieved using the handy library <code>meshio</code>.</li>
<li>In FEniCS a portion of the domain or of the boundary can be identified, or &ldquo;marked&rdquo;, with an integer identifier and called for the definition of a subset with specific material or a boundary condition.</li>
<li>Before the &ldquo;marking&rdquo;, domain boundary and the materials subsets have to be created and it&rsquo;s also a good idea to pre-set them to a null value:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># import the mesh in FEniCS</span>
<span style="color:#66d9ef">with</span> fe<span style="color:#f92672">.</span>XDMFFile( meshfolder <span style="color:#f92672">+</span> meshfilename <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;.xdmf&#34;</span>) <span style="color:#66d9ef">as</span> xdmf:
	mesh <span style="color:#f92672">=</span> fe<span style="color:#f92672">.</span>Mesh()
	xdmf<span style="color:#f92672">.</span>read(mesh)
	mesh<span style="color:#f92672">.</span>init()

<span style="color:#75715e"># Define the whole boundary</span>
boundaries <span style="color:#f92672">=</span> fe<span style="color:#f92672">.</span>MeshFunction(<span style="color:#e6db74">&#34;size_t&#34;</span>, mesh, mesh<span style="color:#f92672">.</span>topology()<span style="color:#f92672">.</span>dim()<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)

<span style="color:#75715e"># initialize marker for the whole boundary</span>
boundaries<span style="color:#f92672">.</span>set_all(<span style="color:#ae81ff">0</span>)

<span style="color:#75715e"># define the whole domain</span>
materials <span style="color:#f92672">=</span> fe<span style="color:#f92672">.</span>MeshFunction(<span style="color:#e6db74">&#34;size_t&#34;</span>, mesh, mesh<span style="color:#f92672">.</span>topology()<span style="color:#f92672">.</span>dim())

<span style="color:#75715e"># initialize marker for the whole domain</span>
materials<span style="color:#f92672">.</span>set_all(<span style="color:#ae81ff">0</span>)
</code></pre></div><ul>
<li>The geometrical subdomains can then be marked by looping over the cells and using the correspondence between the cell identification number and its property&hellip; which we still need to assign!</li>
<li>The assignment has to be made in parallel to the translation operation from whatever format to <code>xdmf</code> and stored in a separate object, a matrix is a good candidate, to be called when needed.</li>
<li>Once all of this is done we get a nice table with the correspondence between the sets we defined in the pre-processor and the integers we can use in FEniCS for identification of geometrical features:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># import the mesh</span>
mesh, boundaries, materials <span style="color:#f92672">=</span> importMesh<span style="color:#f92672">.</span>readMesh(meshfolder, meshfile)

<span style="color:#75715e"># create the boundary integral measure</span>
ds_inner <span style="color:#f92672">=</span> fe<span style="color:#f92672">.</span>Measure(<span style="color:#e6db74">&#34;ds&#34;</span>, subdomain_id<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, subdomain_data<span style="color:#f92672">=</span>boundaries)
</code></pre></div><h2 id="useful-lessons-i-learned">Useful lessons I learned</h2>
<ul>
<li>This project didn&rsquo;t involve much math or scientific thinking but it was critical to allow me to play with real parts coming from CAD into FEniCS!</li>
<li>That&rsquo;s it! I hope this information would turn out useful to anyone, I add the script I use for the conversion at the end of this page.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># -----------------------------------------------------------------70</span>
<span style="color:#75715e"># Import necessary packages</span>
<span style="color:#75715e"># -----------------------------------------------------------------70</span>
<span style="color:#f92672">import</span> fenics <span style="color:#f92672">as</span> fe
<span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np
<span style="color:#f92672">import</span> meshio
<span style="color:#f92672">import</span> os


<span style="color:#75715e">#%% ---------------------------------------------------------------70</span>
<span style="color:#75715e"># Auxiliary functions</span>
<span style="color:#75715e"># -----------------------------------------------------------------70</span>

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">fileprint</span>(string, meshfolder, meshfilename):
    <span style="color:#66d9ef">print</span>(string)
    <span style="color:#66d9ef">with</span> open( meshfolder <span style="color:#f92672">+</span> meshfilename <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;.md&#34;</span>, <span style="color:#e6db74">&#34;a&#34;</span>) <span style="color:#66d9ef">as</span> file:
        file<span style="color:#f92672">.</span>writelines( <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">+</span> string)


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">getMeshInfo</span>(meshfolder, meshfile, identifier <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;cell&#34;</span>, cell_geom <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;triangle&#34;</span>):
    <span style="color:#e6db74">&#34;&#34;&#34;Import the mesh from pre-processor and convert the mesh with Meshio
</span><span style="color:#e6db74">    
</span><span style="color:#e6db74">    - use a specific keywork to identify cell sets in the mesh creation
</span><span style="color:#e6db74">      and pass this keywork to the function as identifier
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">    - specify whether to parse for triangle or tetra:
</span><span style="color:#e6db74">        - 2D case --&gt; cell_geom = &#34;triangle&#34;
</span><span style="color:#e6db74">        - 3D case --&gt; cell_geom = &#34;tetra&#34;
</span><span style="color:#e6db74">    
</span><span style="color:#e6db74">    reference:
</span><span style="color:#e6db74">    https://fenicsproject.discourse.group/t/definition-of-subdomain-by-element-sets/6440
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    
    <span style="color:#75715e"># Take the mesh file name without extension</span>
    meshfilename <span style="color:#f92672">=</span> meshfile<span style="color:#f92672">.</span>rsplit(<span style="color:#e6db74">&#34;.&#34;</span>)[<span style="color:#ae81ff">0</span>]

    <span style="color:#75715e"># read the mesh whatever the format</span>
    pre_mesh <span style="color:#f92672">=</span> meshio<span style="color:#f92672">.</span>read(meshfolder <span style="color:#f92672">+</span> meshfile)

    <span style="color:#75715e"># import the cells sets</span>
    cell_sets <span style="color:#f92672">=</span> pre_mesh<span style="color:#f92672">.</span>cell_sets_dict

    <span style="color:#75715e"># import the cells</span>
    pre_cells <span style="color:#f92672">=</span> pre_mesh<span style="color:#f92672">.</span>get_cells_type(cell_geom)

    <span style="color:#75715e"># number of cells</span>
    n_cells <span style="color:#f92672">=</span> len(pre_cells)

    <span style="color:#75715e"># initialize a matrix to store sets marks for cell data (materials)</span>
    cell_data <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>zeros(n_cells)
    
    <span style="color:#75715e"># initialize a matrix to store sets marks for facet data (boundaries)</span>
    boundaries_data <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>zeros(n_cells)
    
    <span style="color:#75715e"># initialize marker counter</span>
    mrk <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>

    <span style="color:#75715e"># initialize marker dictionary</span>
    mrk_dict <span style="color:#f92672">=</span> {}
    
    <span style="color:#75715e"># loop through the dictionary items of cell_sets</span>
    <span style="color:#75715e"># the key is the set name, the value is the sets cells (type and coordinates)</span>
    <span style="color:#66d9ef">for</span> marker, set <span style="color:#f92672">in</span> sorted(cell_sets<span style="color:#f92672">.</span>items()):
        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;mesh&#34;</span> <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> marker:
            <span style="color:#75715e"># Increse the marker for every set</span>
            mrk <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>

            <span style="color:#75715e"># Store set name and corresponding marker</span>
            mrk_dict[marker] <span style="color:#f92672">=</span> mrk
            
            <span style="color:#75715e"># loop through the types and values for a specific key</span>
            <span style="color:#66d9ef">for</span> type, entities <span style="color:#f92672">in</span> set<span style="color:#f92672">.</span>items():
                <span style="color:#75715e"># check for cell type</span>
                <span style="color:#66d9ef">if</span> type <span style="color:#f92672">==</span> cell_geom:
                    <span style="color:#75715e"># Store in cell_data a marker with increasing int to be visualized in Paraview</span>
                    boundaries_data[entities] <span style="color:#f92672">=</span> int(mrk)
                    
                    <span style="color:#75715e"># identify cell markers and store them in a list</span>
                    <span style="color:#66d9ef">if</span> identifier <span style="color:#f92672">in</span> marker:
                        cell_data[entities] <span style="color:#f92672">=</span> int(mrk)

    <span style="color:#66d9ef">return</span> pre_mesh, cell_data, boundaries_data, mrk, mrk_dict


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">convertMesh</span>(meshfolder, meshfile, identifier <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;cell&#34;</span>, cell_geom <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;triangle&#34;</span>):

    (pre_mesh, cell_data, boundaries_data, mrk, mrk_dict) <span style="color:#f92672">=</span> getMeshInfo(meshfolder, meshfile, identifier, cell_geom)

    <span style="color:#75715e"># import the cells</span>
    pre_cells <span style="color:#f92672">=</span> pre_mesh<span style="color:#f92672">.</span>get_cells_type(cell_geom)

    <span style="color:#75715e"># number of cells</span>
    n_cells <span style="color:#f92672">=</span> len(pre_cells)
    
    <span style="color:#75715e"># Take the mesh file name without extension</span>
    meshfilename <span style="color:#f92672">=</span> meshfile<span style="color:#f92672">.</span>rsplit(<span style="color:#e6db74">&#34;.&#34;</span>)[<span style="color:#ae81ff">0</span>]
    
    <span style="color:#75715e"># Print the total number of cells</span>
    fileprint(f<span style="color:#e6db74">&#34;Total number of cells in mesh = {n_cells}&#34;</span>, meshfolder, meshfilename)

    <span style="color:#75715e"># Print the total number of markers</span>
    fileprint(f<span style="color:#e6db74">&#34;Max marker index: {mrk:2d}&#34;</span>, meshfolder, meshfilename)
    
    <span style="color:#75715e"># Print set name and corresponding marker</span>
    <span style="color:#66d9ef">for</span> key <span style="color:#f92672">in</span> mrk_dict<span style="color:#f92672">.</span>keys():
        fileprint(f<span style="color:#e6db74">&#34;Set: {key} -&gt; marker {mrk_dict[key]}&#34;</span>, meshfolder, meshfilename)

    <span style="color:#75715e"># Translate the mesh in xdmf format bringing the marker info</span>
    post_mesh <span style="color:#f92672">=</span> meshio<span style="color:#f92672">.</span>Mesh(points<span style="color:#f92672">=</span>pre_mesh<span style="color:#f92672">.</span>points,
                            cells<span style="color:#f92672">=</span>{cell_geom: pre_cells},
                            cell_data<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#34;name_to_read&#34;</span>: [cell_data]} )

    <span style="color:#75715e"># Take the mesh file name without extension</span>
    meshfilename <span style="color:#f92672">=</span> meshfile<span style="color:#f92672">.</span>rsplit(<span style="color:#e6db74">&#34;.&#34;</span>)[<span style="color:#ae81ff">0</span>]

    <span style="color:#75715e"># Adjust the filename and output the mesh file in xdmf format</span>
    meshio<span style="color:#f92672">.</span>write( meshfolder <span style="color:#f92672">+</span> meshfilename <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;.xdmf&#34;</span>, post_mesh)


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">readMesh</span>(meshfolder, meshfile, identifier <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;cell&#34;</span>, cell_geom <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;triangle&#34;</span>):
    <span style="color:#75715e"># -----------------------------------------------------------------70</span>
    <span style="color:#75715e"># Convert solid Element sets in surface boundary Facets Sets</span>
    <span style="color:#75715e"># reference</span>
    <span style="color:#75715e"># https://fenicsproject.discourse.group/t/how-to-define-boundary-conditions-on-an-irregular-geometry/2240/18</span>
    <span style="color:#75715e"># -----------------------------------------------------------------70</span>

    <span style="color:#75715e"># Take the mesh file name without extension</span>
    meshfilename <span style="color:#f92672">=</span> meshfile<span style="color:#f92672">.</span>rsplit(<span style="color:#e6db74">&#34;.&#34;</span>)[<span style="color:#ae81ff">0</span>]

    <span style="color:#75715e"># check if mesh has already been converted in xdmf</span>
    xdmf_exists_flag <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    <span style="color:#66d9ef">for</span> file <span style="color:#f92672">in</span> os<span style="color:#f92672">.</span>listdir(meshfolder):
        <span style="color:#66d9ef">if</span> file <span style="color:#f92672">==</span> meshfilename <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;.xdmf&#34;</span>:
            xdmf_exists_flag <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    
    <span style="color:#75715e"># convert the mesh if necessary</span>
    <span style="color:#66d9ef">if</span> xdmf_exists_flag <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
        convertMesh(meshfolder, meshfile, cell_geom <span style="color:#f92672">=</span> cell_geom)
    
    <span style="color:#75715e"># import the mesh in FEniCS</span>
    <span style="color:#66d9ef">with</span> fe<span style="color:#f92672">.</span>XDMFFile( meshfolder <span style="color:#f92672">+</span> meshfilename <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;.xdmf&#34;</span>) <span style="color:#66d9ef">as</span> xdmf:
        mesh <span style="color:#f92672">=</span> fe<span style="color:#f92672">.</span>Mesh()
        xdmf<span style="color:#f92672">.</span>read(mesh)
        mesh<span style="color:#f92672">.</span>init()
      
    <span style="color:#75715e"># Define the whole boundary</span>
    boundaries <span style="color:#f92672">=</span> fe<span style="color:#f92672">.</span>MeshFunction(<span style="color:#e6db74">&#34;size_t&#34;</span>, mesh, mesh<span style="color:#f92672">.</span>topology()<span style="color:#f92672">.</span>dim()<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)

    <span style="color:#75715e"># initialize marker for the whole boundary</span>
    boundaries<span style="color:#f92672">.</span>set_all(<span style="color:#ae81ff">0</span>)

    <span style="color:#75715e"># define the whole domain</span>
    materials <span style="color:#f92672">=</span> fe<span style="color:#f92672">.</span>MeshFunction(<span style="color:#e6db74">&#34;size_t&#34;</span>, mesh, mesh<span style="color:#f92672">.</span>topology()<span style="color:#f92672">.</span>dim())
    
    <span style="color:#75715e"># initialize marker for the whole domain</span>
    materials<span style="color:#f92672">.</span>set_all(<span style="color:#ae81ff">0</span>)
    
    <span style="color:#75715e"># initialize mesh to ask for facets</span>
    cell_to_facet <span style="color:#f92672">=</span> mesh<span style="color:#f92672">.</span>topology()(mesh<span style="color:#f92672">.</span>topology()<span style="color:#f92672">.</span>dim(), mesh<span style="color:#f92672">.</span>topology()<span style="color:#f92672">.</span>dim()<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)

    <span style="color:#75715e"># get cell_data from meshio</span>
    (pre_mesh, cell_data, boundaries_data, mrk, mrk_dict) <span style="color:#f92672">=</span> getMeshInfo(meshfolder, meshfile, identifier, cell_geom)


    <span style="color:#75715e"># loop through cells</span>
    <span style="color:#66d9ef">for</span> cell <span style="color:#f92672">in</span> fe<span style="color:#f92672">.</span>cells(mesh):
        
        <span style="color:#75715e"># mark the cell with info stored in cell_data</span>
        materials<span style="color:#f92672">.</span>set_value(cell<span style="color:#f92672">.</span>index(), int(cell_data[cell<span style="color:#f92672">.</span>index()]))
    
        <span style="color:#75715e"># loop through the facets of a cell</span>
        <span style="color:#66d9ef">for</span> face <span style="color:#f92672">in</span> cell_to_facet(cell<span style="color:#f92672">.</span>index()):
            <span style="color:#75715e"># extract Facet info with Dolfin internal method</span>
            facet <span style="color:#f92672">=</span> fe<span style="color:#f92672">.</span>Facet(mesh, face)
            <span style="color:#75715e"># mark the facet with the info stored in boundaries_data</span>
            <span style="color:#66d9ef">if</span> facet<span style="color:#f92672">.</span>exterior():
                boundaries<span style="color:#f92672">.</span>set_value(facet<span style="color:#f92672">.</span>index(), int(boundaries_data[cell<span style="color:#f92672">.</span>index()]))

    <span style="color:#75715e"># https://www.karlin.mff.cuni.cz/~hron/fenics-tutorial/elasticity/doc.html</span>
    <span style="color:#66d9ef">return</span> mesh, boundaries, materials
    

<span style="color:#75715e">#%% ---------------------------------------------------------------70</span>
<span style="color:#75715e"># Debugging check</span>
<span style="color:#75715e"># -----------------------------------------------------------------70</span>

<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
        
    meshfolder <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;./Meshes/&#34;</span>

    meshfile <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;WST.inp&#34;</span>
    
    mesh, boundaries, materials <span style="color:#f92672">=</span> readMesh(meshfolder, meshfile, cell_geom <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;triangle&#34;</span>)

	fe<span style="color:#f92672">.</span>XDMFFile( meshfolder <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;check_boundaries.xdmf&#34;</span> )<span style="color:#f92672">.</span>write(boundaries)
	fe<span style="color:#f92672">.</span>XDMFFile( meshfolder <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;check_materials.xdmf&#34;</span> )<span style="color:#f92672">.</span>write(materials)

</code></pre></div>
      </article>
    </section>

    

    

    
  </div>
</div>


            <footer class="ui basic center aligned segment" style="background-color: transparent;">
              
              <p>© 2021 - 2024 MechEngrLorenzoFiore</p>
              

              <p>Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a> with theme <a href="https://github.com/g1eny0ung/hugo-theme-dream" target="_blank">Dream</a>.</p>

              
            </footer>
          </div>
        </section>
        <section class="back">
          <div class="dream-max-width">
            <header class="ui basic very padded segment dream-header">
  
  <div class="ui small circular image">
    <img src="/img/avatar_2.jpg" alt="avatar" />
  </div>
  

  <div class="content">
    <h1 class="ui medium header">Lorenzo Fiore&#39;s blog<div class="sub header">Leave the world a better place than you find it</div>
    </h1>

    <article class="ui horizontal list">
      
      <a class="item" href="/posts">
        <i class="archive icon" title="Archives"></i>
      </a>
      
      <a class="item" href="/categories">
        <i class="th list icon" title="All Categories"></i>
      </a>
      <a class="item" href="/tags">
        <i class="tags icon" title="All Tags"></i>
      </a>
    </article>

    
    
    
    
    
      
    
      
    
      
    
      
    
    

    

    
    
    
          <div class="dream-tags">
          
          
          
            <a class="ui label" href="/tags/3d-modelling/" title="3D modelling">
              3D modelling
            </a>
          
          
          
            <a class="ui label" href="/tags/automation/" title="Automation">
              Automation
            </a>
          
          
          
            <a class="ui label" href="/tags/computational/" title="Computational">
              Computational
            </a>
          
          
          
            <a class="ui label" href="/tags/fem/" title="FEM">
              FEM
            </a>
          
          </div>
    

    
  </div>
</header>


<div class="ui relaxed grid dream-grid dream-back">
  
  
  
  <div class="sixteen wide mobile eight wide tablet four wide computer column dream-column">
    <article class="ui segment markdown-body">
      <div class="ui medium header">Once a Scout, always a Scout!</div>
      <p>I&rsquo;m a proud member of the World Wide Scout Movement.</p>
<blockquote>
<p>Try and leave this world a little better than you found it,
and when your turn comes to die,
you can die happy in feeling that at any rate,
you have not wasted your time but have done your best.</p>
</blockquote>
<blockquote>
<p>Robert Baden-Powell, fouder of the Scout Movement</p>
</blockquote>
    </article>
  </div>
  
  <div class="sixteen wide mobile eight wide tablet four wide computer column dream-column">
    <article class="ui segment markdown-body">
      <div class="ui medium header">About me</div>
      <p>If you came up here you want to know a little bit more about myself.
That&rsquo;s awesome!</p>
<p>I&rsquo;m a Mechanical Engineer, a curious person and a maker!
I don&rsquo;t waste any time trying to learn everything I can about the
topic I love the most, be it mechanical design, programming,
old school hand abilities, music, languages, you name it!</p>
<p>This websites purpose is to share my knowledge and experience hoping
this would be of any help for anyone facing the challenges I face.
Enjoy and let&rsquo;s stay in contact!</p>
    </article>
  </div>
  

  <div class="sixteen wide mobile eight wide tablet four wide computer column dream-column">
    <article class="ui segment">
      <div class="ui medium header">Social Links</div>
      <nav class="ui secondary menu dream-menu dream-socials">
  

  

  

  

  

  

  
  <div class="item">
    <a href="https://www.linkedin.com/in/lorenzo-fiore-372b83194" target="_blank">
      <i class="large linkedin icon" title="Linkedin"></i>
    </a>
  </div>
  

  
  <div class="item">
    <a href="https://github.com/MechEngrLorenzoFiore" target="_blank">
      <i class="large github icon" title="GitHub"></i>
    </a>
  </div>
  

  

  
</nav>

    </article>
  </div>

  <div class="sixteen wide mobile eight wide tablet four wide computer column dream-column">
    
  </div>

  
  
</div>

          </div>
        </section>
      </div>
    </div>

    <script>
  window.defaultDark =  null 
  window.backgroundDark =  null 
  window.backgroundImageDark =  null 
  window.darkNav =  null 
  window.hasTwitterEmbed =  null 
  window.maxTags =  null 

  if (window.hasTwitterEmbed) {
    
    window.twttr = (function (d, s, id) {
      var js,
        fjs = d.getElementsByTagName(s)[0],
        t = window.twttr || {}
      if (d.getElementById(id)) return t
      js = d.createElement(s)
      js.id = id
      js.src = 'https://platform.twitter.com/widgets.js'
      fjs.parentNode.insertBefore(js, fjs)

      t._e = []
      t.ready = function (f) {
        t._e.push(f)
      }

      return t
    })(document, 'script', 'twitter-wjs')
  }
</script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/overlayscrollbars@1.13.1/js/jquery.overlayScrollbars.min.js"></script>
<script src="/js/header.js"></script>
<script src="/js/main.js"></script>
<script src="/js/theme.js"></script>

    





<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.0.0-rc.1/dist/html2canvas.min.js"></script>
<script src="/js/post.js" defer></script>


    
    <div class="ui inverted segment" id="dream-search">
  <div class="ui search">
    <div class="ui transparent input">
      <input class="prompt" type="text" placeholder="Search" />
    </div>
    <div class="results"></div>
  </div>
</div>
<script>
  $(document).ready(function () {
    $.getJSON('https:\/\/MechEngrLorenzoFiore.github.io\//index.json', function (data) {
      $('.ui.search').search({
        source: data,
        searchFields: ['title'],
        showNoResults: true,
      })
    })
  })
</script>
<script src="/js/search.js"></script>

    

    

    
  </body>
</html>
